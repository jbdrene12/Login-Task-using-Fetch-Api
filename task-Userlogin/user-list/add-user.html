<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="../styles/sidebar-style.css">
    <link rel="stylesheet" href="./styles/style.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../script-crud.js"></script>
</head>

<body>
    <div id="side-bar" class="float-start vh-100">
        <div class="mt-4 d-flex flex-column justify-content-center">
            <div class="mx-auto">
                <hr style="height: 2px; width: 180px; opacity: .75;background: #2A2A3C;">
            </div>
            <div class="mx-auto"><img src="../assets/square.png" name="square" alt="squares"><a
                    href="../user-default.html" class="text-decoration-none text-light">User List</a></div>

        </div>
    </div>
    <div class="float-end">
        <div class="mx-4">
            <br>
            <h1 class="d-inline h5"><b>Add User</b></h1>
            <a href="../user-default.html" class="float-end btn btn-primary" style="width: 150px;">Back</a>
        </div>
        <div class="mt-4 d-flex justify-content-center align-items-center">
            <form action="../user-default.html" class="mx-4 flex-fill border border-secondary" onsubmit="post(api_url)">
                <fieldset class="my-3">
                    <label class="form-label mx-4" for="f-name">First Name <input type="text" class="form-control"
                            id="f-name" placeholder="First Name" onkeyup="myKeyPress(event,0)" required></label>
                    <label class="form-label" for="l-name">Last Name <input type="text" class="form-control" id="l-name"
                            placeholder="Last Name" onkeyup="myKeyPress(event,1)" required></label>
                </fieldset>
                <fieldset class="mt-3">
                    <label class="form-label mx-4" for="full-name">Full Name <input type="text" class="form-control"
                            id="full-name" disabled placeholder="Full Name"></label>
                    <label class="form-label" for="gender">Gender <input type="text" class="form-control" id="gender"
                            placeholder="male/female" pattern="^(male)|(female)$" maxlength="6" required></label>
                    <p class="text-secondary small mt-0 mx-4">A block of help text that breaks onto a new line and
                        beyond one line.</p>
                </fieldset>
                <fieldset class="mb-3">
                    `<label class="form-label mx-4" for="email">Email <input type="email" class="form-control"
                            placeholder="Email" id="email" required></label>
                    <label class="form-label" for="status">Status <input type="text" class="form-control" id="status"
                            placeholder="Status" pattern="^(active)|(inactive)$" required></label>
                </fieldset>
                <input type="submit" value="Add Parameter" class="btn btn-primary float-end px-5 mx-4 mb-4">
            </form>
        </div>
    </div>

    <script>

        api_url = "https://gorest.co.in/public/v2/users?access-token=3803732897851d7e9809cc003e1b8cc80ad27dcaa86b741c07894ed034de8f21"

        let user;
        async function post(url) {          //  FETCH - POST
            fetch(url, {
                method: "POST",
                body: JSON.stringify({
                    name: document.getElementById("full-name").value,
                    email: document.getElementById("email").value,
                    gender: document.getElementById("gender").value.toLowerCase(),
                    status: document.getElementById("status").value
                }),
                headers: {
                    "Content-type": "application/json; charset=UTF-8",
                    "Authorization": "Bearer"
                }
            })
                
                .then(response => response.json())          
                .then(json => console.log(json));           //  DISPLAY ADDED VALUE AS OBJECT
         
            alert("Success")                                //  POPUP MESSAGE - SUCCESS
        }
        let firstName = "",
            lastName = "";
        const arrayOfId = ["f-name", "l-name"];             //   SAVING FIRST AND LAST NAME IN AN -
                                                            // - ARRAY TO DISPLAY THEM DYNAMICALLY AS FULL NAME 

        function myKeyPress(e, val) {                       //  SAVING KEY PRESS
            if (/^[a-zA-Z0-9]$/.test(e.key)) {
                if (val == 0) {
                    firstName += e.key;                     //  SAVE VALUE ONLY IF IT'S SINGLE CHARACTER - TO AVOID SPECIAL KEYS
                }
                else {
                    lastName += e.key;
                }
                document.getElementById("full-name").value = `${firstName} ${lastName}`;
                                                            //  DISPLAY DYNAMICALLY IN FULL NAME TEXTBOX

            }
            else if (e.key == "Backspace" || e.key == "Delete") {

                val == 0 ? firstName = "" : lastName = "";  //  CLEAR FIELD IF DELETE OR BACKSPACE PRESSED

                document.getElementById(arrayOfId[val]).value = ""; 
                document.getElementById("full-name").value = `${firstName} ${lastName}`;
            }
            if (firstName != document.getElementById(arrayOfId[val]).value || lastName != document.getElementById(arrayOfId[val]).value) {
                val == 0 ? firstName = document.getElementById(arrayOfId[val]).value : lastName = document.getElementById(arrayOfId[val]).value;
                document.getElementById("full-name").value = `${firstName} ${lastName}`; //   REMOVE WRONG ENTRIES IF USER -
                                                                                         // - REPLACES TEXT INSTEAD OF DELETING
            }
            return `${firstName} ${lastName}`;
        }
    </script>
</body>

</html>